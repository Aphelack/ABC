# Лабораторная работа 3: Приоритетный планировщик задач

## Описание программы

Данная программа представляет собой демонстрацию **приоритетного планировщика задач** в защищённом режиме процессора x86. Программа загружается как bootloader и показывает основные принципы многозадачности в операционных системах.

## Ключевые концепции и команды

### 1. Переход в защищённый режим
```asm
cli                    ; Отключаем прерывания
lgdt [gdt_descriptor]  ; Загружаем таблицу глобальных дескрипторов
mov eax, cr0
or eax, 1              ; Устанавливаем бит защищённого режима
mov cr0, eax
jmp CODE_SEG:pm        ; Переход в защищённый режим
```

**Объяснение**: Защищённый режим обеспечивает сегментацию памяти и контроль доступа, что необходимо для многозадачности.

### 2. Таблица задач (Task Control Blocks)
```asm
; Структура: [приоритет, указатель_на_функцию, счётчик_выполнений]
tasks: dd 3, t1, 0    ; Задача 1: приоритет 3 (высший)
       dd 1, t2, 0    ; Задача 2: приоритет 1 (низший)  
       dd 2, t3, 0    ; Задача 3: приоритет 2 (средний)
```

**Идея**: Каждая задача имеет приоритет (чем больше число, тем выше приоритет) и ограничение на количество выполнений.

### 3. Алгоритм приоритетного планирования
```asm
sched:
    mov eax, 0      ; лучший приоритет
    mov ebx, 0      ; лучшая задача
    mov ecx, 0      ; текущий индекс
.lp:
    cmp dword [edx+8], 3  ; проверяем, не выполнялась ли 3 раза
    jge .nx
    cmp dword [edx], eax  ; сравниваем приоритеты
    jle .nx
    mov eax, [edx]        ; обновляем лучший приоритет
    mov ebx, ecx          ; обновляем лучшую задачу
.nx:
    add edx, 12           ; следующая задача (12 байт на задачу)
    inc ecx
    cmp ecx, 3
    jl .lp
```

**Принцип работы**: Планировщик сканирует все задачи, находит задачу с наивысшим приоритетом среди тех, что выполнялись менее 3 раз.

### 4. Межзадачное взаимодействие
```asm
counter dd 0  ; Разделяемая переменная
```

**Задачи взаимодействуют через общую память**:
- **Задача 1**: `inc dword [counter]` - увеличивает счётчик
- **Задача 2**: читает и отображает значение счётчика
- **Задача 3**: `shl eax, 1` - удваивает счётчик

### 5. Вывод на экран (VGA Text Mode)
```asm
mov edi, 0xB8000      ; Адрес видеопамяти VGA
mov ah, 0x0A          ; Зелёный цвет на чёрном фоне
mov [edi], ax         ; Записываем символ с атрибутом
```

**Цветовая схема**:
- Задача 1: Зелёный цвет (0x0A)
- Задача 2: Жёлтый цвет (0x0E)  
- Задача 3: Красный цвет (0x0C)

## Результат выполнения программы

```
Lab3: Priority Scheduler
T1(P:3) T2(P:1) T3(P:2)
R1:T1 C=1    ; Раунд 1: Задача 1, Счётчик=1
R2:T1 C=2    ; Раунд 2: Задача 1, Счётчик=2  
R3:T1 C=3    ; Раунд 3: Задача 1, Счётчик=3
R4:T3 C=6    ; Раунд 4: Задача 3, Счётчик=6 (3*2)
R5:T3 C=4    ; Раунд 5: Задача 3, Счётчик=4 (6*2 mod 8)
R6:T3 C=0    ; Раунд 6: Задача 3, Счётчик=0 (4*2 mod 8)
R7:T2 C=0    ; Раунд 7: Задача 2, Счётчик=0
R8:T2 C=0    ; Раунд 8: Задача 2, Счётчик=0
R9:T2 C=0    ; Раунд 9: Задача 2, Счётчик=0
```

## Образовательная ценность

Программа демонстрирует:

1. **Приоритетное планирование** - задачи выполняются в порядке приоритетов
2. **Предотвращение голодания** - каждая задача выполняется максимум 3 раза
3. **Разделение ресурсов** - общий счётчик показывает взаимодействие задач
4. **Состояния задач** - отслеживание выполнения через счётчики
5. **Низкоуровневое программирование** - прямая работа с памятью и регистрами

## Ключевые особенности реализации

- **Размер**: Точно 512 байт (ограничение bootloader)
- **Режим**: Защищённый режим x86 с собственной GDT
- **Вывод**: Одновременно в serial port и VGA text mode
- **Планирование**: Round-robin с приоритетами и ограничениями

Это практическая демонстрация основ операционных систем на уровне железа!